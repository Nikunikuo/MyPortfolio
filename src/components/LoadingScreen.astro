---
---

<div class="loading-screen" id="loading-screen">
	<div class="loading-content">
		<div class="terminal">
			<div class="terminal-header">
				<span class="terminal-title">SYSTEM INITIALIZING...</span>
			</div>
			<div class="terminal-body">
				<p class="loading-text">
					<span class="prompt">&gt;</span> Accessing M1RA Archive...
				</p>
				<p class="loading-text delay-1">
					<span class="prompt">&gt;</span> Loading creative protocols...
				</p>
				<p class="loading-text delay-2">
					<span class="prompt">&gt;</span> Establishing connection...
				</p>
				<div class="loading-bar">
					<div class="loading-progress"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.loading-screen {
		position: fixed;
		top: 0;
		left: 0;
		width: 100vw;
		height: 100vh;
		background: #000;
		z-index: 9999;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: opacity 0.8s ease-out;
	}

	.loading-screen.fade-out {
		opacity: 0;
		pointer-events: none;
	}

	.loading-content {
		max-width: 600px;
		width: 90%;
	}

	.terminal {
		background: rgba(0, 20, 40, 0.9);
		border: 2px solid #00ff88;
		border-radius: 8px;
		box-shadow:
			0 0 20px rgba(0, 255, 136, 0.3),
			inset 0 0 30px rgba(0, 255, 136, 0.05);
		overflow: hidden;
	}

	.terminal-header {
		background: rgba(0, 255, 136, 0.1);
		padding: 0.75rem 1rem;
		border-bottom: 1px solid #00ff88;
	}

	.terminal-title {
		color: #00ff88;
		font-family: 'Courier New', monospace;
		font-size: 0.9rem;
		font-weight: bold;
		letter-spacing: 2px;
	}

	.terminal-body {
		padding: 2rem 1.5rem;
	}

	.loading-text {
		color: #00ff88;
		font-family: 'Courier New', monospace;
		font-size: 0.95rem;
		margin: 0.5rem 0;
		opacity: 0;
		animation: fadeInText 0.5s ease-out forwards;
	}

	.loading-text.delay-1 {
		animation-delay: 0.3s;
	}

	.loading-text.delay-2 {
		animation-delay: 0.6s;
	}

	.prompt {
		color: #00ccff;
		margin-right: 0.5rem;
	}

	.loading-bar {
		margin-top: 2rem;
		height: 8px;
		background: rgba(0, 255, 136, 0.1);
		border-radius: 4px;
		overflow: hidden;
		border: 1px solid rgba(0, 255, 136, 0.3);
	}

	.loading-progress {
		height: 100%;
		background: linear-gradient(90deg, #00ff88, #00ccff);
		width: 0%;
		box-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
		transition: width 0.3s ease-out;
	}

	@keyframes fadeInText {
		to {
			opacity: 1;
		}
	}
</style>

<script>
	const loadingScreen = document.getElementById('loading-screen');
	const loadingProgress = loadingScreen?.querySelector('.loading-progress') as HTMLElement;

	let hasEnded = false;
	let currentProgress = 0;
	const startTime = Date.now();
	const minDisplayTime = 1500; // 最低1.5秒は表示

	// プログレスバーを更新する関数
	const updateProgress = (progress: number) => {
		if (loadingProgress) {
			loadingProgress.style.width = `${Math.min(progress, 100)}%`;
		}
	};

	// プログレスバーをじわじわ進める（疑似的）
	const progressInterval = setInterval(() => {
		if (currentProgress < 90) {
			// 90%まではゆっくり進む
			currentProgress += Math.random() * 10;
			updateProgress(currentProgress);
		}
	}, 200);

	// ローディングを終了する関数
	const endLoading = () => {
		if (hasEnded || !loadingScreen) return;

		const elapsedTime = Date.now() - startTime;
		const remainingTime = Math.max(0, minDisplayTime - elapsedTime);

		// プログレスバーを100%に
		clearInterval(progressInterval);
		updateProgress(100);

		// 最低表示時間を確保してからフェードアウト
		setTimeout(() => {
			hasEnded = true;
			loadingScreen.classList.add('fade-out');

			// フェードアウト後にDOMから削除
			setTimeout(() => {
				loadingScreen.remove();
			}, 800);
		}, remainingTime + 300); // プログレスバーが100%になってから少し待つ
	};

	// 全リソース読み込み完了を待つ（最も確実）
	if (document.readyState === 'complete') {
		// すでに読み込み完了している場合
		endLoading();
	} else {
		// loadイベントを待つ（画像・動画・CSS全て完了）
		window.addEventListener('load', endLoading);
	}

	// 保険として最大8秒で強制終了
	setTimeout(() => {
		if (!hasEnded) {
			console.warn('Loading timeout - forcing end');
			endLoading();
		}
	}, 8000);
</script>
