---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Icon from '../../components/Icon.astro';
import ContactCTA from '../../components/ContactCTA.astro';
import { challenges100days, categoryLabels } from '../../data/100daysData';

const title = '#AIå‰µä½œ100æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸ | å¤§é¹¿ãƒ‹ã‚¯ / M1RA';
const description = '2025å¹´8æœˆ9æ—¥ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ãŸ#AIå‰µä½œ100æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®è»Œè·¡ã€‚ç”ŸæˆAIã‚’ä½¿ã£ãŸå‰µä½œã‚’100æ—¥é–“æ¯æ—¥ç¶™ç¶šã™ã‚‹æŒ‘æˆ¦ã®è¨˜éŒ²ã€‚';
---

<BaseLayout title={title} description={description}>
	<div class="stack gap-20">
		<main class="wrapper stack gap-8">
			<Hero
				title="#AIå‰µä½œ100æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸"
				tagline="2025/8/9ï½ ç”ŸæˆAIã§æ¯æ—¥å‰µä½œã‚’ç¶šã‘ã‚‹100æ—¥é–“ã®è»Œè·¡"
				align="start"
			/>

			<!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆã‚¨ãƒªã‚¢ -->
			<section class="controls">
				<div class="search-box">
					<Icon icon="search" size="1.2em" />
					<input type="text" id="searchInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚„å†…å®¹ã§æ¤œç´¢..." />
				</div>

				<div class="filter-buttons">
					<button class="filter-btn active" data-category="all">å…¨ã¦</button>
					<button class="filter-btn" data-category="music">ğŸµ éŸ³æ¥½</button>
					<button class="filter-btn" data-category="anime">ğŸ¬ ã‚¢ãƒ‹ãƒ¡</button>
					<button class="filter-btn" data-category="tool">ğŸ’» ãƒ„ãƒ¼ãƒ«</button>
					<button class="filter-btn" data-category="manga">ğŸ“š æ¼«ç”»</button>
					<button class="filter-btn" data-category="other">âœ¨ ãã®ä»–</button>
				</div>

				<div class="sort-buttons">
					<button class="sort-btn active" data-sort="asc">å¤ã„é † â†‘</button>
					<button class="sort-btn" data-sort="desc">æ–°ã—ã„é † â†“</button>
				</div>
			</section>

			<!-- ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ -->
			<section class="cards-grid" id="cardsGrid">
				{challenges100days.map((challenge) => (
					<div
						class="challenge-card"
						data-day={challenge.day}
						data-category={challenge.category}
						data-title={challenge.title.toLowerCase()}
						data-summary={challenge.summary.toLowerCase()}
					>
						<div class="card-image">
							<img src={challenge.imagePath} alt={challenge.title} loading="lazy" />
							<div class="day-badge">{challenge.day}/100</div>
						</div>
						<div class="card-content">
							<div class="card-date">{challenge.date}</div>
							<h3 class="card-title">{challenge.title}</h3>
							<p class="card-summary">{challenge.summary}</p>
							<div class="card-category">{categoryLabels[challenge.category]}</div>
						</div>
					</div>
				))}
			</section>

			<!-- çµæœãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
			<div id="noResults" class="no-results" style="display: none;">
				<Icon icon="warning" size="3em" />
				<p>è©²å½“ã™ã‚‹æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
			</div>
		</main>
		<ContactCTA />
	</div>

	<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
	<div id="modal" class="modal">
		<div class="modal-content">
			<button class="modal-close" id="modalClose">
				<Icon icon="x-logo" size="1.5em" />
			</button>
			<div id="modalBody"></div>
		</div>
	</div>
</BaseLayout>

<style>
	.controls {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		margin-top: 2rem;
	}

	.search-box {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 1rem 1.5rem;
		background: rgba(0, 20, 40, 0.6);
		border: 2px solid rgba(0, 255, 136, 0.3);
		border-radius: 0.75rem;
		color: #00ff88;
	}

	.search-box input {
		flex: 1;
		background: transparent;
		border: none;
		color: #ffffff;
		font-size: var(--text-base);
		outline: none;
	}

	.search-box input::placeholder {
		color: rgba(255, 255, 255, 0.5);
	}

	.filter-buttons, .sort-buttons {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	.filter-btn, .sort-btn {
		padding: 0.75rem 1.5rem;
		background: rgba(0, 20, 40, 0.6);
		border: 2px solid rgba(0, 255, 136, 0.3);
		border-radius: 0.5rem;
		color: rgba(255, 255, 255, 0.9);
		font-size: var(--text-sm);
		font-weight: 600;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.filter-btn:hover, .sort-btn:hover {
		border-color: #00ff88;
		background: rgba(0, 255, 136, 0.1);
		transform: translateY(-2px);
	}

	.filter-btn.active, .sort-btn.active {
		background: rgba(0, 255, 136, 0.2);
		border-color: #00ff88;
		color: #00ff88;
	}

	.cards-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
		gap: 2rem;
		margin-top: 2rem;
	}

	.challenge-card {
		background: rgba(0, 20, 40, 0.6);
		border: 2px solid rgba(0, 255, 136, 0.3);
		border-radius: 1rem;
		overflow: hidden;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.challenge-card:hover {
		border-color: #00ff88;
		box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
		transform: translateY(-5px);
	}

	.card-image {
		position: relative;
		width: 100%;
		padding-bottom: 56.25%; /* 16:9 */
		overflow: hidden;
		background: rgba(0, 0, 0, 0.5);
	}

	.card-image img {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.3s ease;
	}

	.challenge-card:hover .card-image img {
		transform: scale(1.05);
	}

	.day-badge {
		position: absolute;
		top: 1rem;
		right: 1rem;
		padding: 0.5rem 1rem;
		background: linear-gradient(135deg, #ff0080, #ff8c00);
		color: #ffffff;
		font-weight: 700;
		font-size: var(--text-sm);
		border-radius: 0.5rem;
		box-shadow: 0 4px 12px rgba(255, 0, 128, 0.5);
		z-index: 10;
	}

	.card-content {
		padding: 1.5rem;
	}

	.card-date {
		font-size: var(--text-sm);
		color: #00ff88;
		margin-bottom: 0.5rem;
	}

	.card-title {
		font-size: var(--text-lg);
		font-weight: 700;
		color: #ffffff;
		margin-bottom: 0.75rem;
	}

	.card-summary {
		font-size: var(--text-sm);
		color: rgba(255, 255, 255, 0.8);
		line-height: 1.6;
		margin-bottom: 1rem;
	}

	.card-category {
		font-size: var(--text-sm);
		color: rgba(255, 255, 255, 0.7);
	}

	.no-results {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 1rem;
		padding: 4rem 2rem;
		color: rgba(255, 255, 255, 0.7);
		text-align: center;
	}

	/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
	.modal {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.85);
		z-index: 1000;
		overflow-y: auto;
		padding: 2rem;
	}

	.modal.active {
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.modal-content {
		position: relative;
		max-width: 800px;
		width: 100%;
		background: rgba(0, 20, 40, 0.95);
		border: 2px solid rgba(0, 255, 136, 0.5);
		border-radius: 1rem;
		padding: 2rem;
		box-shadow: 0 0 40px rgba(0, 255, 136, 0.3);
	}

	.modal-close {
		position: absolute;
		top: 1rem;
		right: 1rem;
		background: rgba(255, 0, 0, 0.2);
		border: 2px solid rgba(255, 0, 0, 0.5);
		border-radius: 50%;
		width: 3rem;
		height: 3rem;
		display: flex;
		align-items: center;
		justify-content: center;
		color: #ff0088;
		cursor: pointer;
		transition: all 0.3s ease;
		z-index: 10;
	}

	.modal-close:hover {
		background: rgba(255, 0, 0, 0.4);
		transform: rotate(90deg);
	}

	@media (max-width: 768px) {
		.cards-grid {
			grid-template-columns: 1fr;
		}

		.filter-buttons {
			justify-content: center;
		}

		.modal-content {
			padding: 1.5rem;
			margin: 1rem;
		}
	}
</style>

<script>
	import { challenges100days } from '../../data/100daysData';

	// DOMè¦ç´ 
	const searchInput = document.getElementById('searchInput') as HTMLInputElement;
	const cardsGrid = document.getElementById('cardsGrid') as HTMLElement;
	const noResults = document.getElementById('noResults') as HTMLElement;
	const filterButtons = document.querySelectorAll('.filter-btn');
	const sortButtons = document.querySelectorAll('.sort-btn');
	const modal = document.getElementById('modal') as HTMLElement;
	const modalClose = document.getElementById('modalClose') as HTMLElement;
	const modalBody = document.getElementById('modalBody') as HTMLElement;

	let currentCategory = 'all';
	let currentSort = 'asc';

	// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆãƒ»æ¤œç´¢
	function filterAndSort() {
		const searchTerm = searchInput.value.toLowerCase();
		const cards = Array.from(document.querySelectorAll('.challenge-card')) as HTMLElement[];

		let visibleCount = 0;

		cards.forEach(card => {
			const category = card.dataset.category || '';
			const title = card.dataset.title || '';
			const summary = card.dataset.summary || '';
			const day = parseInt(card.dataset.day || '0');

			// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
			const categoryMatch = currentCategory === 'all' || category === currentCategory;
			const searchMatch = title.includes(searchTerm) || summary.includes(searchTerm);

			if (categoryMatch && searchMatch) {
				card.style.display = 'block';
				visibleCount++;
			} else {
				card.style.display = 'none';
			}
		});

		// ã‚½ãƒ¼ãƒˆ
		const sortedCards = cards.sort((a, b) => {
			const dayA = parseInt(a.dataset.day || '0');
			const dayB = parseInt(b.dataset.day || '0');
			return currentSort === 'asc' ? dayA - dayB : dayB - dayA;
		});

		sortedCards.forEach(card => cardsGrid.appendChild(card));

		// çµæœãªã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
		noResults.style.display = visibleCount === 0 ? 'block' : 'none';
	}

	// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³
	filterButtons.forEach(btn => {
		btn.addEventListener('click', () => {
			filterButtons.forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
			currentCategory = btn.dataset.category || 'all';
			filterAndSort();
		});
	});

	// ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³
	sortButtons.forEach(btn => {
		btn.addEventListener('click', () => {
			sortButtons.forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
			currentSort = btn.dataset.sort || 'asc';
			filterAndSort();
		});
	});

	// æ¤œç´¢
	searchInput.addEventListener('input', filterAndSort);

	// ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
	document.querySelectorAll('.challenge-card').forEach((card, index) => {
		card.addEventListener('click', () => {
			const challenge = challenges100days[index];
			showModal(challenge);
		});
	});

	// ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
	function showModal(challenge: any) {
		let embedContent = '';

		// YouTubeåŸ‹ã‚è¾¼ã¿
		if (challenge.youtubeId) {
			embedContent = `
				<div class="modal-video">
					<iframe
						width="100%"
						height="400"
						src="https://www.youtube.com/embed/${challenge.youtubeId}"
						title="${challenge.title}"
						frameborder="0"
						allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen
					></iframe>
				</div>
			`;
		} else {
			embedContent = `<img src="${challenge.imagePath}" alt="${challenge.title}" class="modal-image" />`;
		}

		// XåŸ‹ã‚è¾¼ã¿ï¼ˆURLãŒã‚ã‚‹å ´åˆï¼‰
		const xEmbed = challenge.xUrl
			? `<a href="${challenge.xUrl}" target="_blank" rel="noopener noreferrer" class="x-link">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
						<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
					</svg>
					å…ƒã®Xãƒã‚¹ãƒˆã‚’è¦‹ã‚‹
				</a>`
			: '';

		modalBody.innerHTML = `
			<div class="modal-header">
				<div class="modal-day-badge">${challenge.day}/100</div>
				<div class="modal-date">${challenge.date}</div>
			</div>
			<h2 class="modal-title">${challenge.title}</h2>
			<p class="modal-summary">${challenge.summary}</p>
			${embedContent}
			${xEmbed}
		`;

		modal.classList.add('active');
		document.body.style.overflow = 'hidden';
	}

	// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
	modalClose.addEventListener('click', closeModal);
	modal.addEventListener('click', (e) => {
		if (e.target === modal) closeModal();
	});

	function closeModal() {
		modal.classList.remove('active');
		document.body.style.overflow = '';
	}

	// åˆæœŸã‚½ãƒ¼ãƒˆ
	filterAndSort();
</script>

<style is:global>
	.modal-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: 1rem;
	}

	.modal-day-badge {
		padding: 0.5rem 1rem;
		background: linear-gradient(135deg, #ff0080, #ff8c00);
		color: #ffffff;
		font-weight: 700;
		font-size: var(--text-sm);
		border-radius: 0.5rem;
	}

	.modal-date {
		font-size: var(--text-sm);
		color: #00ff88;
	}

	.modal-title {
		font-size: var(--text-2xl);
		color: #ffffff;
		font-weight: 700;
		margin-bottom: 1rem;
	}

	.modal-summary {
		font-size: var(--text-base);
		color: rgba(255, 255, 255, 0.9);
		line-height: 1.8;
		margin-bottom: 2rem;
	}

	.modal-image {
		width: 100%;
		border-radius: 0.75rem;
		margin-bottom: 1.5rem;
	}

	.modal-video {
		position: relative;
		width: 100%;
		margin-bottom: 1.5rem;
		border-radius: 0.75rem;
		overflow: hidden;
	}

	.modal-video iframe {
		width: 100%;
		aspect-ratio: 16 / 9;
	}

	.x-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.75rem 1.5rem;
		background: rgba(29, 155, 240, 0.1);
		border: 2px solid rgba(29, 155, 240, 0.5);
		border-radius: 0.5rem;
		color: #1d9bf0;
		text-decoration: none;
		font-weight: 600;
		transition: all 0.3s ease;
	}

	.x-link:hover {
		background: rgba(29, 155, 240, 0.2);
		border-color: #1d9bf0;
		transform: translateY(-2px);
	}
</style>
